window.__YAVER_LA_PATCH__="v2-check-001";var _____WB$wombat$assign$function_____=function(e){return self._wb_wombat&&self._wb_wombat.local_init&&self._wb_wombat.local_init(e)||self[e]};self.__WB_pmw||(self.__WB_pmw=function(e){return this.__WB_source=e,this});{let e=_____WB$wombat$assign$function_____("window");_____WB$wombat$assign$function_____("self"),_____WB$wombat$assign$function_____("document"),_____WB$wombat$assign$function_____("location"),_____WB$wombat$assign$function_____("top"),_____WB$wombat$assign$function_____("parent"),_____WB$wombat$assign$function_____("frames"),_____WB$wombat$assign$function_____("opener");var version="1.13.2";e.__YAVER_LA_PATCH__="v2-check-001";var keyToEdit,current_units,scriptName="LA Enhancer (1.13.2)",scriptURL="https://yasinenes92.github.io/yaver-LA/",updateNotesURL="https://yasinenes92.github.io/yaver-LA/",working=!0,resourcesLoaded=!1,scriptLoaded=!1,pagesLoaded=!1,filtersApplied=!1,cansend=!0,keySetMode=!1,hideRow=!1,editingKey=!1,troubleshoot=!1,clearProfiles=!1,reason=[],currentGameTime=getCurrentGameTime(),sitter="";"0"!=e.top.game_data.player.sitter&&(sitter="t="+e.top.game_data.player.id+"&");var userset,link=["https://"+e.location.host+"/game.php?"+sitter+"village=","&screen=am_farm"];function mv_parseCoordFromRow(e){var t=e.text().match(/(\d{1,3})\|(\d{1,3})/);return t?{x:parseInt(t[1],10),y:parseInt(t[2],10)}:null}function mv_dist(e,t,o,r){var i=e-o,a=t-r;return Math.sqrt(i*i+a*a)}function mv_getAllVillages(){var t=[];try{var o=e.top.document.querySelector("#village_switch");if(o)o.querySelectorAll("option").forEach(function(e){var o=String(e.value||"").trim(),r=String(e.textContent||"").match(/(\d{1,3})\|(\d{1,3})/);o&&r&&t.push({id:o,x:parseInt(r[1],10),y:parseInt(r[2],10)})})}catch(e){}if(!t.length&&e.top.game_data&&e.top.game_data.village&&e.top.game_data.village.coord){var r=String(e.top.game_data.village.coord).match(/(\d{1,3})\|(\d{1,3})/);r&&t.push({id:String(e.top.game_data.village.id),x:parseInt(r[1],10),y:parseInt(r[2],10)})}return t}function mv_candidateSources(e){var t=mv_getAllVillages().map(function(t){return{id:t.id,d:mv_dist(t.x,t.y,e.x,e.y)}});return t.sort(function(e,t){return e.d-t.d}),t.map(function(e){return e.id})}function mv_sendLinkForVillage(t){var o=e.top.Accountmanager.send_units_link;return o?o.replace(/([?&]village=)\d+/,"$1"+t):null}var s={start_page:0,end_page:1,order_by:2,direction:3,all_none:4,blue:5,green:6,yellow:7,red_yellow:8,red_blue:9,red:10,hide_recent_farms:11,sent_time_filter:12,hide_recent_time:13,enable_hauls:14,full:15,partial:16,enable_attacks:17,attack_operator:18,attack_value:19,enable_walls:20,wall_operator:21,wall_value:22,enable_distances:23,distance_operator:24,distance_value:25,enable_scout:26,scout_report_operator:27,haul_value:28,continent_display:29,continents_list:30,enable_time:31,attack_time_filter:32,time_value:33,enable_auto_run:34,next_village_no_farms:35,next_village_scouts:36,scouts_left:37,next_village_farming_troops:38,farming_troops_left:39,next_village_units:40},keycodes={a:65,b:66,c:67,skip:83,right:39,left:37,master:77},keyPressSettings={a_code:65,a_char:"A",b_code:66,b_char:"B",c_code:67,c_char:"C",master_code:77,master_char:"M",skip_code:83,skip_char:"S",left_code:37,left_char:"\xc3\xa2\xe2\u20ac \xc2\x90",right_code:39,right_char:"\xc3\xa2\xe2\u20ac \xe2\u20ac\u2122",priorityOneEnabled:!0,priorityOneProfile:"Default",priorityOneButton:"Skip",priorityTwoEnabled:!0,priorityTwoProfile:"Default",priorityTwoButton:"Skip",priorityThreeEnabled:!0,priorityThreeProfile:"Default",priorityThreeButton:"Skip",defaultButton:"Skip"},availableLangs=["en","es","el","ar","it"];try{e.top&&e.$&&e.$.getScript&&(e.top.$&&e.top.$.getScript||(e.top.$=e.$),!e.top.jQuery&&e.jQuery&&(e.top.jQuery=e.jQuery))}catch(t){}function run(){console.log("run"),checkVersion(),checkWorking(),setVersion(),makeItPretty(),showSettings(),turnOnHotkeys(),hotkeysOnOff(),0!=userset[s.enable_auto_run]&&applySettings()}function checkVersion(){if(getVersion()!=version)if(buttons=[{text:"OK",callback:null,confirm:!0}],clearProfiles){var t=e.top.$.jStorage.get("profileList");e.top.$.each(t,function(t,o){e.top.$.jStorage.deleteKey("profile:"+o)}),e.top.$.jStorage.set("keyPressSettings",keyPressSettings),Dialog.show("update_dialog","This script has recently been updated to version <span style='font-weight:bold;'>"+version+"</span> and in order for the new version to work, all profiles and settings must be reset. Sorry for any inconvenience.<br /><br/><a href='"+updateNotesURL+"' target='_blank'>See what's new</a>.</br>I removed the difference between the original and the Alt version of the script. Both are now equally fast and even faster than either script was before. Should you  enounter any issues, please contact me on the forum! </br></br>Enjoy!</br>Ibra Gonza II")}else Dialog.show("update_dialog","This script has recently been updated to version <span style='font-weight:bold;'>"+version+"</span><br /><br/><a href='"+updateNotesURL+"' target='_blank'>See what's new</a>.</br>I removed the difference between the original and the Alt version of the script. Both are now equally fast and even faster than either script was before. Should you  enounter any issues, please contact me on the forum! </br></br>Enjoy!</br>Ibra Gonza II")}function checkWorking(){var t=e.top.$.jStorage.get("working");null==t&&e.top.$.jStorage.set("working",!1),getVersion()!=version&&e.top.$.jStorage.set("working",!1),0==working&&0==t&&(buttons=[{text:"OK",callback:null,confirm:!0}],e.top.UI.ConfirmationBox("An error has been discovered in this version. You may continue testing the script if you haven't noticed the error.",buttons,!1,[]),e.top.$.jStorage.set("working",!0))}function setVersion(){e.top.$.jStorage.set("version",version)}function getVersion(){var t=e.top.$.jStorage.get("version");return null==t?(setVersion(),version):t}function showAllRows(){var t=e.top.$.trim(e.top.$("#plunder_list_nav tr:first td:last").children().last().html().replace(/\D+/g,""));"max"==e.top.$("#end_page").val()&&e.top.$("#end_page").text(t),e.top.$("#am_widget_Farm tr:last").remove(),t>parseInt(e.top.$("#end_page").val(),10)&&(t=parseInt(e.top.$("#end_page").val(),10)),setTimeout(function(){getPage(parseInt(e.top.$("#start_page").val(),10)-1,t)},1)}function getPage(t,o){if(t<o){changeHeader(filter_41+" "+(t+1)+"/"+o+" <img src='graphic/throbber.gif' height='24' width='24'></img>");var r=link[0]+e.top.game_data.village.id+"&order="+userset[s.order_by]+"&dir="+userset[s.direction]+"&Farm_page="+t+"&screen=am_farm";e.top.$.ajax({type:"GET",url:r,dataType:"html",error:function(e,t,o){console.log("Get page failed with error: "+o)},success:function(r){e.top.$("#plunder_list tr",r).slice(2).each(function(){e.top.$("#plunder_list tr:last").after("<tr>"+e.top.$(this).html()+"</tr>")}),setTimeout(function(){getPage(t+1,o)},1)}})}else setTimeout(function(){addTableInfo(),applyFilters(),changeHeader(filter_40),highlightRows()},1),e.top.$("#plunder_list").show(),e.top.Accountmanager.initTooltips(),pagesLoaded=!0,cansend=!0}function changeHeader(t){e.top.$("h3:first").html(t)}function highlightRows(){e.top.$("#am_widget_Farm table").each(function(){e.top.$("tr:even:gt(0) td",this).not("table:first").css("backgroundColor","#FFF5DA"),e.top.$("tr:odd:gt(0) td",this).not("table:first").css("backgroundColor","#F0E2BE")})}function getNewVillage(t){"n"==t?e.top.UI.InfoMessage("Switching to next village...",500):e.top.UI.InfoMessage("Switching to previous village...",500),e.onkeydown=function(){},cansend=!1,filtersApplied=!1,Timing.pause(),fadeThanksToCheese(),openLoader();var o=link[0]+t+e.top.game_data.village.id+link[1];e.top.$.ajax({type:"GET",url:o,dataType:"html",error:function(t,o){alert("Error: "+o),e.top.$("#fader").remove(),e.top.$("#loaders").remove()},success:function(t){var o=e.top.$(t),r=/<\s*title\s*>([^<]+)<\/title\s*>/g.exec(t)[1],i=e.top.$.parseJSON(t.split("TribalWars.updateGameData(")[1].split(");")[0]);e.top.game_data=i,"undefined"!=typeof history&&"function"==typeof history.pushState&&history.pushState({},e.top.game_data.village.name+" - Loot Assistant","https://"+e.top.location.host+game_data.link_base_pure+"am_farm"),e.top.$("#header_info").html(e.top.$("#header_info",o).html()),e.top.$("#topContainer").html(e.top.$("#topContainer",o).html()),e.top.$("#contentContainer").html(e.top.$("#contentContainer",o).html()),e.top.$("#quickbar_inner").html(e.top.$("#quickbar_inner",o).html()),e.top.$("head").find("title").html(r),e.top.$("#fader").remove(),e.top.$("#loaders").remove(),Timing.resetTickHandlers(),Timing.pause(),pagesLoaded=!1,cansend=!1,run()}})}function yaver_patch_inline_onclicks(){try{var t=e.top.$("#settingsDiv");if(!t.length)return;t.find("[onclick]").each(function(){var e=this.getAttribute("onclick");e&&(e=e.replace(/\bapplySettings\s*\(/g,"window.applySettings(").replace(/\bresetTable\s*\(/g,"window.resetTable(").replace(/\bchangeProfile\s*\(/g,"window.changeProfile(").replace(/\bcreateProfile\s*\(/g,"window.createProfile(").replace(/\bsetDefaultProfile\s*\(/g,"window.setDefaultProfile(").replace(/\bdeleteProfile\s*\(/g,"window.deleteProfile(").replace(/\bupdateProfile\s*\(/g,"window.updateProfile(").replace(/\bexportProfile\s*\(/g,"window.exportProfile(").replace(/\bimportProfile\s*\(/g,"window.importProfile(").replace(/\bloadLanguage\s*\(/g,"window.loadLanguage(").replace(/\buglyHider\s*\(/g,"window.uglyHider(").replace(/\bsetKeyEditMode\s*\(/g,"window.setKeyEditMode("),this.setAttribute("onclick",e))})}catch(e){}}function showSettings(){e.top.$("head").append("<link type='text/css' rel='stylesheet' href='"+scriptURL+"css/style.css' />"),e.top.$("#contentContainer h3").eq(0).after(e.top.$("<div class='vis'id='settingsDiv'><table class='settingsTable'><thead><tr><th colspan='5'class='vis'style='padding:0px;'><h4> "+scriptName+" - <a href='https://web.archive.org/web/20240307223803/http://forum.tribalwars.net/showthread.php?266604-ntoombs19-s-FA-Filter'target='_blank'>"+filter_02+"</a> - "+filter_42+": <select id='language'style='margin:0px;'onchange='loadLanguage(window.top.$(&quot;#language&quot;).val())'></select><span style='font-size:10px;float:right;font-weight:normal;font-style:normal'>"+filter_03+" <a href='https://web.archive.org/web/20240307223803/http://forum.tribalwars.net/member.php?22739-ntoombs19'target='_blank'>ntoombs19</a>&nbsp;<div class='vis'style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#'num='2'onclick='uglyHider(window.top.$(this));return false;'>-</a></div></span></h4></th></tr></thead><tbody id='settingsBody'><tr><td class='col1'style='min-width:200px'><span>"+filter_04+"</span>&nbsp;<input type='text'value=''size='2'maxlength='3'id='start_page'>&nbsp;<span>"+filter_05+"</span>&nbsp;<input type='text'value=''size='2'maxlength='3'id='end_page'></td><td colspan='3'><span style='font-weight:bold'>"+filter_06+"</span>&nbsp;<img src='graphic/questionmark.png'width='13'height='13'id='enable_help'></td><td rowspan='5'valign='top'><form><input type='checkbox'id='all_none'>&nbsp;<label for='all_none'style='font-weight:bold'>"+filter_07+"</label>&nbsp;<img src='graphic/questionmark.png'width='13'height='13'id='report_help'><br><input type='checkbox'id='blue'><label for='blue'><img src='graphic/dots/blue.png'>&nbsp;"+filter_08+"</label><br><input type='checkbox'id='green'><label for='green'><img src='graphic/dots/green.png'>&nbsp;"+filter_09+"</label><br><input type='checkbox'id='yellow'><label for='yellow'><img src='graphic/dots/yellow.png'>&nbsp;"+filter_10+"</label><br><input type='checkbox'id='red_yellow'><label for='red_yellow'><img src='graphic/dots/red_yellow.png'>&nbsp;"+filter_11+"</label><br><input type='checkbox'id='red_blue'><label for='red_blue'><img src='graphic/dots/red_blue.png'>&nbsp;"+filter_12+"</label><br><input type='checkbox'id='red'><label for='red'><img src='graphic/dots/red.png'>&nbsp;"+filter_13+"</label></form></td></tr><tr><td rowspan='2'><label for='order_by'>"+filter_14+":</label>&nbsp;<select id='order_by'val='distance'><option value='distance'>"+filter_15+"</option><option value='date'>"+filter_16+"</option></select><br><label for='direction'>"+filter_17+":</label>&nbsp;<select id='direction'val='desc'><option value='asc'>"+filter_18+"</option><option value='desc'>"+filter_19+"</option></select></td><td style='width:26px'><input type='checkbox'id='enable_hauls'></td><td style='width:110px'><label for='enable_hauls'>"+filter_20+"</label></td><td><input type='radio'name='hauls'id='full'><label for='full'><img src='graphic/max_loot/1.png'>"+filter_21+"</label>&nbsp;<input type='radio'name='hauls'id='partial'><label for='partial'><img src='graphic/max_loot/0.png'>"+filter_22+"</label></td></tr><tr><td><input type='checkbox'id='enable_attacks'></td><td><label for='enable_attacks'>"+filter_23+"</label></td><td><select id='attack_operator'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='attack_value'size='2'maxlength='2'value=''></td></tr><tr><td rowspan='1'><span style='font-weight:bold;'>"+filter_43+"</span></td><td><input type='checkbox'id='enable_walls'></td><td><label for='enable_walls'>"+filter_30+"</label></td><td><select id='wall_operator'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='wall_value'size='2'maxlength='2'value=''></td></tr><tr><td><input type='checkbox'id='next_village_no_farms'><label for='next_village_no_farms'>"+filter_39+"</label></td><td><input type='checkbox'id='enable_distances'></td><td><label for='enable_distances'>"+filter_31+"</label></td><td><select id='distance_operator'val='greater_than'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='distance_value'size='2'maxlength='2'value=''></td></tr><tr><td><input type='checkbox' id='next_village_units' />"+filter_44+"</td><td><input type='checkbox' id='enable_continents' /><td colspan='3'><select id='continent_display'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;<label for='continents_list'>"+filter_34+"</label>&nbsp;<input type='text'size='2'maxlength='150'id='continents_list'value=''>&nbsp;<img src='graphic/questionmark.png'height='13'id='continent_help'></td></tr><tr><td><input type='checkbox' id='next_village_scouts' /><input type='text' size='2' id='scouts_left' /> "+filter_45+"</td><td><input type='checkbox'id='enable_scout'></td><td colspan='3'><label for='enable_scout'>"+filter_35+"</label>&nbsp;<select id='scout_report_operator'val='greater_than'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='haul_value'size='9'maxlength='7'value=''></td></tr><tr><td><input type='checkbox' id='next_village_farming_troops' /><input type='text' size='2' id='farming_troops_left' /> "+filter_46+"</td><td><input type='checkbox'id='enable_time'></td><td colspan='3'><select id='attack_time_filter'val='hide'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;<label for='enable_time'>"+filter_36+"</label>&nbsp;<input type='text'id='time_value'size='2'maxlength='4'value=''><span>"+filter_37+"</span></td></tr><tr><td><input type='checkbox'id='enable_auto_run'><label for='enable_autoRun'>"+filter_38+"</label></td><td><input type='checkbox' id='hide_recent_farms' /></td><td colspan='3'><select id='sent_time_filter'val='hide'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;"+filter_47+" <input type='text' size='2' id='hide_recent_time' /> "+filter_48+"</td></tr><tr><th>"+filter_49+"</th><th colspan='4'>"+filter_50+"</th></tr><tr><td rowspan='4'><table><tr class='hotkey_values'><td><a href='#'onclick='return setKeyEditMode(\"A\")'id='button_a'class='farm_icon farm_icon_a'></a></td><td><a href='#'onclick='return setKeyEditMode(\"B\")'id='button_b'class='farm_icon farm_icon_b'></a></td><td><a href='#'onclick='return setKeyEditMode(\"C\")'id='button_c'class='farm_icon farm_icon_c'></a></td><td><a href='#'onclick='return setKeyEditMode(\"Master\")'id='button_master'class='farm_icon farm_icon_m'></a></td></tr><tr class='hotkey_values'><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_a'value='A'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_b'value='B'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_c'value='C'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_master'value='M'></td></tr><tr class='hotkey_values'><td colspan='2'><input class='btn tooltip'onclick='return setKeyEditMode(\"Skip\")'type='button'value='Skip'style='margin:0px 0px 0px 0px'title='"+filter_51+"'></td><td><input class='btn tooltip'onclick='return setKeyEditMode(\"Left\")'type='button'value='\u2190'style='margin:0px 0px 0px 0px'title='"+filter_52+"'></td><td><input class='btn tooltip'type='button'onclick='return setKeyEditMode(\"Right\")'value='\u2192'style='margin:0px 0px 0px 0px'title='"+filter_53+"'></td></tr><tr class='hotkey_values'><td colspan='2'><input type='text'class='hotkey_value' READONLY id='hotkey_value_skip'value='S'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_left'value='&#8592;'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_right'value='&#8594;'></td></tr></table></td><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityOneEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityOneProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityOneButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityTwoEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityTwoProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityTwoButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityThreeEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityThreeProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityThreeButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td colspan='4'>"+filter_60+" <select id='defaultButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td colspan='5'><div style='float:left'><input type='submit'value='"+profile_02+"'onclick='applySettings()'>&nbsp;<input type='submit'value='"+profile_03+"'onclick='resetTable()'></div><div style='float:right'><img src='graphic/questionmark.png'width='13'height='13'id='profile_help'>&nbsp;<label for='settingsProfile'>"+profile_01+":</label>&nbsp;<select id='settingsProfile'onchange='changeProfile(window.top.$(&quot;#settingsProfile&quot;).val())'></select>&nbsp;<input type='submit'value='"+profile_04+"'onclick='createProfile()'>&nbsp;<input type='submit'value='"+profile_05+"'onclick='setDefaultProfile()'>&nbsp;<input type='submit'value='"+profile_06+"'onclick='deleteProfile()'>&nbsp;<input type='submit'value='"+profile_07+"'onclick='updateProfile()'>&nbsp;<input type='submit'value='"+profile_08+"'onclick='exportProfile()'>&nbsp;<input type='submit'value='"+profile_09+"'onclick='importProfile()'></div></td></tr></tbody></table></div>")),formatSettings(),addLanguages(),e.top.$("#language option[value='"+e.top.$.jStorage.get("language")+"']").attr("selected","selected"),yaver_patch_inline_onclicks()}function formatSettings(){e.top.$("#all_none").bind("click",function(){e.top.$(this).closest("form").find(":checkbox").prop("checked",this.checked)});var t=e.top.$("#report_help");t.attr("title",instructions_01),e.top.UI.ToolTip(t);var o=e.top.$("#enable_help");o.attr("title",instructions_02),e.top.UI.ToolTip(o);var r=e.top.$("#continent_help");r.attr("title",instructions_03),e.top.UI.ToolTip(r);var i=e.top.$("#recent_help");i.attr("title",instructions_04),e.top.UI.ToolTip(i);var a=e.top.$("#profile_help");a.attr("title",instructions_05),e.top.UI.ToolTip(a),loadDefaultProfile(),fillProfileList(),fillMasterSettings(),fillKeypressSettings()}function removeFirstPage(){e.top.$("#plunder_list tr:gt(0)").remove(),e.top.$("#plunder_list_nav").hide()}function customSendUnits(t,o,r,i){if(!checkIfNextVillage()){if(i.closest("tr").hide(),(t=e.top.$(t)).hasClass("farm_icon_disabled"))return!1;var a=i.closest("tr"),l=mv_parseCoordFromRow(a),n=String(e.top.game_data.village.id),s=[];l&&(s=mv_candidateSources(l)),s.length||(s=[n]);var p=0;return function t(){if(p>=s.length)return e.top.UI.ErrorMessage("No village had enough units for this template.",2e3),void a.show();var l=String(s[p++]),c=mv_sendLinkForVillage(l)||e.top.Accountmanager.send_units_link,d={target:o,template_id:r,source:l};e.top.$.post(c,d,function(r){if(r&&r.error)return"Not enough units available"===r.error?void t():(e.top.UI.ErrorMessage(r.error),void a.show());if(setLocalStorageRow(o),void 0!==e.top.$(i).prop("tooltipText")){var s=e.top.$(i).prop("tooltipText").split(/<br\s*?\/?>/gi);s.splice(s.length-2,1),e.top.UI.SuccessMessage(s.join(" "),100)}else e.top.UI.SuccessMessage("Sent \u2705",100);String(l)===n&&e.top.Accountmanager.farm.updateOwnUnitsAvailable(r.current_units)},"json")}(),!1}}function customSendUnitsFromReport(t,o,r,i){if(!checkIfNextVillage()){if(i.closest("tr").hide(),(t=e.top.$(t)).hasClass("farm_icon_disabled"))return!1;var a={report_id:r};return e.top.$.post(e.top.Accountmanager.send_units_link_from_report,a,function(t){if(t.error){if(userset[s.next_village_units]&&"Not enough units available"===t.error)return cansend&&filtersApplied&&getNewVillage("n"),!1;e.top.UI.ErrorMessage(t.error),i.closest("tr").show()}else if(setLocalStorageRow(o),"string"==typeof t.success){if(void 0!==e.top.$(i).prop("tooltipText"))var r=e.top.$(i).prop("tooltipText");var a=e.top.$("<div></div>").append(e.top.$(r)),l=(e.top.$(a).find('img[src*="res.png"]').eq(0).attr("src"),r.split(/<br\s*?\/?>/gi));l.splice(l.length-2,1),e.top.UI.SuccessMessage(l.join(" "),100),e.top.Accountmanager.farm.updateOwnUnitsAvailable(t.current_units)}},"json"),!1}}function setOnclick(t){var o=t.find("a").attr("onclick");if(void 0!==o){var r=o.slice(o.indexOf("(")+1,o.indexOf(")")),i=r.split(",");-1==o.indexOf("FromReport")?t.find("a").attr("onclick","return customSendUnits("+r+", window.top.$(this))"):t.find("a").attr("onclick","return customSendUnitsFromReport("+r+"))"),t.closest("tr").attr("name",e.top.$.trim(i[1]))}}function addTableInfo(){e.top.$("#am_widget_Farm tr th").slice(0,1).after("<th></th>"),e.top.$("#am_widget_Farm tr:not(:first-child)").each(function(t){e.top.$(this).children("td").each(function(o){switch(o){case 1:e.top.$(this).filter(":first").before("<td style='width:10px;font-weight:bold;' id='rowNum'>"+(t+1)+"</td>");break;case 3:var r=e.top.$(this).find("img"),i=e.top.$(this).find("img").prop("tooltipText");if(void 0!==i){var a=i.replace(/\D/g,"");r.after("<span style='font-weight:bold;'> ("+a+")</span>")}break;case 8:case 9:case 10:setOnclick(e.top.$(this))}})})}function checkIfNextVillage(){if((current_units=e.top.Accountmanager.farm.current_units,userset[s.next_village_scouts])&&current_units.spy<=parseInt(userset[s.scouts_left]))return getNewVillage("n"),!0;if(userset[s.next_village_farming_troops]){var t=0;if(e.top.$(".fm_unit input:checked").each(function(o){var r=e.top.$(this).attr("name");t+=parseInt(current_units[r])}),t<=parseInt(userset[s.farming_troops_left]))return getNewVillage("n"),!0}if(userset[s.next_village_no_farms]&&0==e.top.$("#plunder_list tr:not(:first-child):visible").length)return getNewVillage("n"),!0}function applySettings(){try{e.updateProfile&&e.updateProfile()}catch(e){}pagesLoaded?applyFilters():(setTimeout(showAllRows(),1),removeFirstPage())}function applyFilters(){e.top.$("#am_widget_Farm tr:gt(0)").each(function(t){(hideRow=checkRowToHide(e.top.$(this),userset))&&e.top.$(this).hide()}),changeHeader(filter_40);var t=0;"fixed"==e.top.$("#topContainer").css("position")&&(t=e.top.$("#topContainer").height()),e.top.$('*:contains("Bot Protection")').length?(e.top.$("html, body").animate({scrollTop:e.top.$('*:contains("Bot Protection")').offset().top-t},500),"function"==typeof showNotification&&showNotification("custom",["LA Enhancer has encountered bot protection. Please respond to captcha to continue farming."],null,"Bot Protection"),cansend=!1):e.top.$("html, body").animate({scrollTop:e.top.$("#farm_units").offset().top-t},500),filtersApplied=!0}function checkRowToHide(t,o){return hideRow=!1,t.children("td").each(function(t){switch(t){case 2:reportSettings(e.top.$(this),o);break;case 3:haulSettings(e.top.$(this),o);break;case 4:hideRecentlyFarmed(e.top.$(this),o),attackSettings(e.top.$(this),o),continentSettings(e.top.$(this),o);break;case 5:hideTime(e.top.$(this),o);break;case 6:scoutReportSettings(e.top.$(this),o);break;case 7:wallSettings(e.top.$(this),o);break;case 8:distanceSettings(e.top.$(this),o)}}),!!hideRow&&(troubleshoot&&console.log(t.find("#rowNum").html()+": ("+reason.join(",")+")"),reason=[],!0)}function resetTable(){e.top.$("#plunder_list tr").each(function(t){e.top.$(this).show()})}function setLocalStorageRow(t){var o="sitter:"+sitter+", village:"+t+", world:"+getURL()[0];e.top.$.jStorage.set(o,getCurrentGameTime())}function reportSettings(e,t){return e.html().indexOf("blue")>=0&&t[s.blue]?(reason.push("Report is blue"),void(hideRow=!0)):e.html().indexOf("green")>=0&&t[s.green]?(reason.push("Report is green"),void(hideRow=!0)):e.html().indexOf("yellow")>=0&&t[s.yellow]?(reason.push("Report is yellow"),void(hideRow=!0)):e.html().indexOf("red_yellow")>=0&&t[s.red_yellow]?(reason.push("Report is red_yellow"),void(hideRow=!0)):e.html().indexOf("red_blue")>=0&&t[s.red_blue]?(reason.push("Report is red_blue"),void(hideRow=!0)):e.html().indexOf("red")>=0&&t[s.red]?(reason.push("Report is red"),void(hideRow=!0)):void 0}function haulSettings(e,t){if(t[s.enable_hauls]){if(e.html().indexOf("max_loot/1")>=0&&t[s.full])return reason.push("Haul is full"),void(hideRow=!0);if(e.html().indexOf("max_loot/0")>=0&&t[s.partial])return reason.push("Haul is partial"),void(hideRow=!0);if(-1==e.html().indexOf("max_loot")&&t[s.full])return reason.push("No haul graphic"),void(hideRow=!0)}}function hideRecentlyFarmed(t,o){if(o[s.hide_recent_farms]){var r=t.closest("tr").attr("name");localTitle="sitter:"+sitter+", village:"+r+", world:"+getURL()[0];var i=new Date(e.top.$.jStorage.get(localTitle)),a=currentGameTime.getTime()-i.getTime(),l=Math.abs(parseInt(a/1e3/60));switch(o[s.sent_time_filter]){case"hide":if(l<parseInt(o[s.hide_recent_time]))return reason.push("Village was recently sent to "+l+" minutes ago"),void(hideRow=!0);break;case"show":if(l>parseInt(o[s.hide_recent_time]))return reason.push("Village was not recently sent to"),void(hideRow=!0)}}}function attackSettings(e,t){var o,r=e.find("img");if(o=void 0!==r.prop("tooltipText")?parseInt(r.prop("tooltipText").replace(/\D/g,"")):0,t[s.enable_attacks])switch(t[s.attack_operator]){case"greater_than":if(o>parseInt(t[s.attack_value]))return reason.push("Outgoing attacks is too many"),void(hideRow=!0);break;case"less_than":if(o<parseInt(t[s.attack_value]))return reason.push("Outgoing attacks is too few"),void(hideRow=!0);break;case"equal_to":if(o==parseInt(t[s.attack_value]))return reason.push("Outgoing attacks is equal"),void(hideRow=!0)}}function continentSettings(t,o){var r=t.find("a").html();if(void 0!==r){r=r.substr(r.length-2);var i=o[s.continents_list].split(".");if(e.top.$.inArray(r,i)>=0&&"hide"==o[s.continent_display])return reason.push("Continent is set to hide"),void(hideRow=!0);if(-1==e.top.$.inArray(r,i)&&"show"==o[s.continent_display])return reason.push("Continent is not set to show"),void(hideRow=!0)}}function hideTime(e,t){if(t[s.enable_time]){var o=currentGameTime,r=getVillageAttackedTime(e),i=o.getTime()-r.getTime(),a=Math.abs(parseInt(i/1e3/60));switch(t[s.attack_time_filter]){case"hide":if(a<parseInt(t[s.time_value]))return reason.push("Village attacked "+a+" minutes ago."),void(hideRow=!0);break;case"show":if(a>parseInt(t[s.time_value]))return reason.push("Village attacked "+a+" minutes ago."),void(hideRow=!0)}}}function scoutReportSettings(t,o){var r;if(o[s.enable_scout]){if("?"==e.top.$.trim(t.find("span").html()))r=0;else r=parseInt(t.children("span").eq(0).html().replace(/\D+/g,""))+parseInt(t.children("span").eq(1).html().replace(/\D+/g,""))+parseInt(t.children("span").eq(2).html().replace(/\D+/g,""));switch(o[s.scout_report_operator]){case"greater_than":if(r>parseInt(o[s.haul_value]))return reason.push("Too many resources"),void(hideRow=!0);break;case"less_than":if(r<parseInt(o[s.haul_value]))return reason.push("Not enough resources"),void(hideRow=!0);break;case"equal_to":if(r==parseInt(o[s.haul_value]))return reason.push("Exact resources"),void(hideRow=!0)}}}function wallSettings(t,o){if(o[s.enable_walls]){var r=parseInt(t.html());switch("?"==r&&(r=0),e.top.$.trim(o[s.wall_operator])){case"greater_than":if(r>parseInt(o[s.wall_value]))return reason.push("Wall too high"),void(hideRow=!0);break;case"less_than":if(r<parseInt(o[s.wall_value]))return reason.push("Wall too low"),void(hideRow=!0);break;case"equal_to":if(r==parseInt(o[s.wall_value]))return reason.push("Wall is exact"),void(hideRow=!0)}}}function distanceSettings(t,o){if(o[s.enable_distances]){var r=t.html();switch(e.top.$.trim(o[s.distance_operator])){case"greater_than":if(parseFloat(r)>parseFloat(o[s.distance_value]))return reason.push("Village too far"),void(hideRow=!0);break;case"less_than":if(parseFloat(r)<parseFloat(o[s.distance_value]))return reason.push("Village too close"),void(hideRow=!0);break;case"equal_to":if(parseFloat(r)==parseFloat(o[s.distance_value]))return reason.push("Village exact distance"),void(hideRow=!0)}}}function deleteRecentlyFarmed(){e.top.$("#am_widget_Farm tr:gt(0)").each(function(t){e.top.$(this).children("td").each(function(t){4==t&&(reportLinkText=e.top.$.trim(e.top.$(this).children("a").html()),localTitle="sitter:"+sitter+", village:"+reportLinkText+", world:"+getURL()[0],null!=e.top.$.jStorage.get(localTitle)&&e.top.$.jStorage.deleteKey(localTitle))})})}function getCurrentGameTime(){var t=e.top.$("#serverTime").html().split(":"),o=e.top.$("#serverDate").html().split("/");return new Date(o[2],o[1]-1,o[0],t[0],t[1],t[2],0)}function getVillageAttackedTime(t){for(var o,r,i=(h=t.html()).split(" "),a=0;a<i.length;a++)(t=e.top.$.trim(i[a])).indexOf(".")>-1?o=t:t==filter_61?o=filter_61:t==filter_62&&(o=filter_62),t.indexOf(":")>-1&&(r=t);if(o==filter_61||o==filter_62){var l=currentGameTime.getDate();o==filter_62&&l--;var n=currentGameTime.getMonth(),s=currentGameTime.getFullYear(),p=(h=r.split(":"))[0],c=h[1],d=h[2];return new Date(s,n,l,p,c,d,0)}var u=o.split(".");l=u[0],n=u[1]-1;if(0==currentGameTime.getMonth()&&11==n)s=currentGameTime.getFullYear()-1;else s=currentGameTime.getFullYear();var h;p=(h=r.split(":"))[0],c=h[1],d=h[2];return new Date(s,n,l,p,c,d,0)}function loadDefaultProfile(){null==e.top.$.jStorage.get("profile:"+profile_10)&&(e.top.$.jStorage.set("profile:"+profile_10,["1","1","distance","asc",!1,!1,!1,!1,!1,!1,!1,!1,"hide","",!1,!1,!1,!1,"greater_than","",!1,"greater_than","",!1,"greater_than","",!1,"greater_than","","hide","",!1,"hide","",!1,!1,!1,"",!1,"",!1]),e.top.$.jStorage.deleteKey("profileList"),e.top.$.jStorage.set("profileList",[profile_10])),userset=e.top.$.jStorage.get("profile:"+profile_10),loadProfile(profile_10),e.top.$("#settingsProfile").val(profile_10)}function setDefaultProfile(){if(e.top.$("#settingsProfile").val()==profile_10){if(!confirm(dialog_02))return!1;createProfile(),setDefaultProfile()}else{var t=e.top.$.jStorage.get("profile:"+e.top.$("#settingsProfile").val());e.top.$.jStorage.set("profile:"+profile_10,t)}}function fillProfileList(){var t=e.top.$.jStorage.get("profileList");e.top.$.each(t,function(t,o){e.top.$("#settingsProfile").append("<option value='"+o+"'>"+o+"</option>")}),e.top.$("#settingsProfile").val(e.top.$.jStorage.get("DefaultProfile"))}function createProfile(){var t=prompt(dialog_03+":");if(-1!=e.top.$.inArray(t,e.top.$.jStorage.get("profileList")))return alert(dialog_04),createProfile(),!1;if(""==t)return alert(dialog_05),createProfile(),!1;if(null!=t&&""!=t){var o=[];o.push(e.top.$("#start_page").val()),o.push(e.top.$("#end_page").val()),o.push(e.top.$("#order_by").val()),o.push(e.top.$("#direction").val()),o.push(e.top.$("#all_none").prop("checked")),o.push(e.top.$("#blue").prop("checked")),o.push(e.top.$("#green").prop("checked")),o.push(e.top.$("#yellow").prop("checked")),o.push(e.top.$("#red_yellow").prop("checked")),o.push(e.top.$("#red_blue").prop("checked")),o.push(e.top.$("#red").prop("checked")),o.push(e.top.$("#hide_recent_farms").prop("checked")),o.push(e.top.$("#sent_time_filter").val()),o.push(e.top.$("#hide_recent_time").val()),o.push(e.top.$("#enable_hauls").prop("checked")),o.push(e.top.$("#full").prop("checked")),o.push(e.top.$("#partial").prop("checked")),o.push(e.top.$("#enable_attacks").prop("checked")),o.push(e.top.$("#attack_operator").val()),o.push(e.top.$("#attack_value").val()),o.push(e.top.$("#enable_walls").prop("checked")),o.push(e.top.$("#wall_operator").val()),o.push(e.top.$("#wall_value").val()),o.push(e.top.$("#enable_distances").prop("checked")),o.push(e.top.$("#distance_operator").val()),o.push(e.top.$("#distance_value").val()),o.push(e.top.$("#enable_scout").prop("checked")),o.push(e.top.$("#scout_report_operator").val()),o.push(e.top.$("#haul_value").val()),o.push(e.top.$("#continent_display").val()),o.push(e.top.$("#continents_list").val()),o.push(e.top.$("#enable_time").prop("checked")),o.push(e.top.$("#attack_time_filter").val()),o.push(e.top.$("#time_value").val()),o.push(e.top.$("#enable_auto_run").prop("checked")),o.push(e.top.$("#next_village_no_farms").prop("checked")),o.push(e.top.$("#next_village_scouts").prop("checked")),o.push(e.top.$("#scouts_left").val()),o.push(e.top.$("#next_village_farming_troops").prop("checked")),o.push(e.top.$("#farming_troops_left").val()),o.push(e.top.$("#next_village_units").prop("checked")),e.top.$.jStorage.set("profile:"+t,o);var r=e.top.$.jStorage.get("profileList");r.push(t),e.top.$.jStorage.set("profileList",r),e.top.$("#settingsProfile").append("<option value='"+t+"'>"+t+"</option>"),e.top.$("#priorityOneProfile").append("<option value='"+t+"'>"+t+"</option>"),e.top.$("#priorityTwoProfile").append("<option value='"+t+"'>"+t+"</option>"),e.top.$("#priorityThreeProfile").append("<option value='"+t+"'>"+t+"</option>"),e.top.$("#settingsProfile").val(t)}}function loadProfile(t){var o=e.top.$.jStorage.get("profile:"+t);userset=o,e.top.$("#start_page").val(o[0]),e.top.$("#end_page").val(o[1]),e.top.$("#order_by").val(o[2]),e.top.$("#direction").val(o[3]),e.top.$("#all_none").prop("checked",o[4]),e.top.$("#blue").prop("checked",o[5]),e.top.$("#green").prop("checked",o[6]),e.top.$("#yellow").prop("checked",o[7]),e.top.$("#red_yellow").prop("checked",o[8]),e.top.$("#red_blue").prop("checked",o[9]),e.top.$("#red").prop("checked",o[10]),e.top.$("#hide_recent_farms").prop("checked",o[11]),e.top.$("#sent_time_filter").val(o[12]),e.top.$("#hide_recent_time").val(o[13]),e.top.$("#enable_hauls").prop("checked",o[14]),e.top.$("#full").prop("checked",o[15]),e.top.$("#partial").prop("checked",o[16]),e.top.$("#enable_attacks").prop("checked",o[17]),e.top.$("#attack_operator").val(o[18]),e.top.$("#attack_value").val(o[19]),e.top.$("#enable_walls").prop("checked",o[20]),e.top.$("#wall_operator").val(o[21]),e.top.$("#wall_value").val(o[22]),e.top.$("#enable_distances").prop("checked",o[23]),e.top.$("#distance_operator").val(o[24]),e.top.$("#distance_value").val(o[25]),e.top.$("#enable_scout").prop("checked",o[26]),e.top.$("#scout_report_operator").val(o[27]),e.top.$("#haul_value").val(o[28]),e.top.$("#continent_display").val(o[29]),e.top.$("#continents_list").val(o[30]),e.top.$("#enable_time").prop("checked",o[31]),e.top.$("#attack_time_filter").val(o[32]),e.top.$("#time_value").val(o[33]),e.top.$("#enable_auto_run").prop("checked",o[34]),e.top.$("#next_village_no_farms").prop("checked",o[35]),e.top.$("#next_village_scouts").prop("checked",o[36]),e.top.$("#scouts_left").val(o[37]),e.top.$("#next_village_farming_troops").prop("checked",o[38]),e.top.$("#farming_troops_left").val(o[39]),e.top.$("#next_village_units").prop("checked",o[40])}function changeProfile(e){loadProfile(e),resetTable(),applyFilters()}function deleteProfile(){var t=e.top.$("#settingsProfile").val();if(t==profile_10)alert(dialog_06);else{var o=e.top.$.jStorage.get("profileList");o.splice(o.indexOf(t),1),e.top.$.jStorage.set("profileList",o),e.top.$.jStorage.deleteKey("profile:"+t),e.top.$("#settingsProfile option[value='"+t+"']").remove(),e.top.$("#priorityOneProfile option[value='"+t+"']").remove(),e.top.$("#priorityTwoProfile option[value='"+t+"']").remove(),e.top.$("#priorityThreeProfile option[value='"+t+"']").remove(),loadDefaultProfile(profile_10)}}function updateProfile(){var t=e.top.$("#settingsProfile").val(),o=[];o.push(e.top.$("#start_page").val()),o.push(e.top.$("#end_page").val()),o.push(e.top.$("#order_by").val()),o.push(e.top.$("#direction").val()),o.push(e.top.$("#all_none").prop("checked")),o.push(e.top.$("#blue").prop("checked")),o.push(e.top.$("#green").prop("checked")),o.push(e.top.$("#yellow").prop("checked")),o.push(e.top.$("#red_yellow").prop("checked")),o.push(e.top.$("#red_blue").prop("checked")),o.push(e.top.$("#red").prop("checked")),o.push(e.top.$("#hide_recent_farms").prop("checked")),o.push(e.top.$("#sent_time_filter").val()),o.push(e.top.$("#hide_recent_time").val()),o.push(e.top.$("#enable_hauls").prop("checked")),o.push(e.top.$("#full").prop("checked")),o.push(e.top.$("#partial").prop("checked")),o.push(e.top.$("#enable_attacks").prop("checked")),o.push(e.top.$("#attack_operator").val()),o.push(e.top.$("#attack_value").val()),o.push(e.top.$("#enable_walls").prop("checked")),o.push(e.top.$("#wall_operator").val()),o.push(e.top.$("#wall_value").val()),o.push(e.top.$("#enable_distances").prop("checked")),o.push(e.top.$("#distance_operator").val()),o.push(e.top.$("#distance_value").val()),o.push(e.top.$("#enable_scout").prop("checked")),o.push(e.top.$("#scout_report_operator").val()),o.push(e.top.$("#haul_value").val()),o.push(e.top.$("#continent_display").val()),o.push(e.top.$("#continents_list").val()),o.push(e.top.$("#enable_time").prop("checked")),o.push(e.top.$("#attack_time_filter").val()),o.push(e.top.$("#time_value").val()),o.push(e.top.$("#enable_auto_run").prop("checked")),o.push(e.top.$("#next_village_no_farms").prop("checked")),o.push(e.top.$("#next_village_scouts").prop("checked")),o.push(e.top.$("#scouts_left").val()),o.push(e.top.$("#next_village_farming_troops").prop("checked")),o.push(e.top.$("#farming_troops_left").val()),o.push(e.top.$("#next_village_units").prop("checked")),e.top.$.jStorage.set("profile:"+t,o),userset=o}function exportProfile(){var t=e.top.$("#settingsProfile").val(),o=e.top.$.jStorage.get("profile:"+t);if(t==profile_10)alert(dialog_07);else prompt(dialog_08,dialog_09A+""+t+dialog_09B+t+","+o+dialog_09C)}function importProfile(){var t=prompt(dialog_10+":",dialog_11),o=(t=t.split(","))[0];t.shift();var r=e.top.$.jStorage.get("profileList");if(-1!=e.top.$.inArray(o,r))return alert(dialog_12),!1;for(i=0;i<=t.length;i++)"false"!==t[i]&&"true"!==t[i]||(t[i]=parseBool(t[i]));e.top.$.jStorage.set("profile:"+o,t),r.push(o),e.top.$.jStorage.set("profileList",r),e.top.$("#settingsProfile").append("<option value='"+o+"'>"+o+"</option>"),e.top.$("#settingsProfile").val(o),loadProfile(o)}function hotkeysOnOff(){e.top.$("#settingsBody tr:lt(9) input,#settingsBody tr:lt(9) select").focusin(function(){e.onkeydown=function(){}}),e.top.$("#settingsBody tr:lt(9) input,#settingsBody tr:lt(9) select").focusout(function(){turnOnHotkeys()})}function turnOnHotkeys(){e.onkeydown=function(t){if(editingKey)editKey(t);else{var o=e.top.$("#plunder_list tr").filter(":visible").eq(1),r=o.children("td").eq(9).children("a"),i=o.children("td").eq(10).children("a"),a=o.children("td").eq(11).children("a");switch(t.which){case keycodes.a:tryClick(r);break;case keycodes.b:tryClick(i);break;case keycodes.c:tryClick(a);break;case keycodes.skip:o.hide();break;case keycodes.master:cansend&&filtersApplied&&selectMasterButton(o);break;case keycodes.left:getNewVillage("p");break;case keycodes.right:getNewVillage("n");break;default:return}}t.preventDefault()}}function tryClick(t){cansend&&filtersApplied&&(checkIfNextVillage()||(console.log(t.html()),t.hasClass("farm_icon_disabled")||null==t.html()?(e.top.UI.ErrorMessage("That button is not selectable. Skipping row...",500),t.closest("tr").hide()):(t.click(),userset[s.next_village_scouts]||userset[s.next_village_farming_troops],doTime(200))))}function doTime(e){cansend=!1,setTimeout(function(){cansend=!0},e)}function editKey(t){if(t.keyCode<=37&&t.keyCode>=40||t.keyCode<=48&&t.keyCode>=90)e.top.UI.ErrorMessage("You can only enter letters, numbers, or arrows. Plese try another key.",1500);else{var o=String.fromCharCode(t.keyCode);switch(37==t.keyCode&&(o="\xc3\xa2\xe2\u20ac \xc2\x90"),38==t.keyCode&&(o="\xc3\xa2\xe2\u20ac \xe2\u20ac\u02dc"),39==t.keyCode&&(o="\xc3\xa2\xe2\u20ac \xe2\u20ac\u2122"),40==t.keyCode&&(o="\xc3\xa2\xe2\u20ac \xe2\u20ac\u0153"),keyToEdit){case"A":keycodes.a=t.keyCode,e.top.$("#hotkey_value_a").val(o);break;case"B":keycodes.b=t.keyCode,e.top.$("#hotkey_value_b").val(o);break;case"C":keycodes.c=t.keyCode,e.top.$("#hotkey_value_c").val(o);break;case"Master":keycodes.master=t.keyCode,e.top.$("#hotkey_value_master").val(o);break;case"Skip":keycodes.skip=t.keyCode,e.top.$("#hotkey_value_skip").val(o);break;case"Left":keycodes.left=t.keyCode,e.top.$("#hotkey_value_left").val(o);break;case"Right":keycodes.right=t.keyCode,e.top.$("#hotkey_value_right").val(o);break;default:return}e.top.UI.SuccessMessage(o+" is now mapped to the "+keyToEdit+" button."),updateKeypressSettings(),editingKey=!1}}function updateKeypressSettings(){keyPressSettings.a_code=keycodes.a,keyPressSettings.a_char=e.top.$("#hotkey_value_a").val(),keyPressSettings.b_code=keycodes.b,keyPressSettings.b_char=e.top.$("#hotkey_value_b").val(),keyPressSettings.c_code=keycodes.c,keyPressSettings.c_char=e.top.$("#hotkey_value_c").val(),keyPressSettings.master_code=keycodes.master,keyPressSettings.master_char=e.top.$("#hotkey_value_master").val(),keyPressSettings.skip_code=keycodes.skip,keyPressSettings.skip_char=e.top.$("#hotkey_value_skip").val(),keyPressSettings.left_code=keycodes.left,keyPressSettings.left_char=e.top.$("#hotkey_value_left").val(),keyPressSettings.right_code=keycodes.right,keyPressSettings.right_char=e.top.$("#hotkey_value_right").val(),keyPressSettings.priorityOneEnabled=e.top.$("#priorityOneEnabled").prop("checked"),keyPressSettings.priorityOneProfile=e.top.$("#priorityOneProfile").val(),keyPressSettings.priorityOneButton=e.top.$("#priorityOneButton").val(),keyPressSettings.priorityTwoEnabled=e.top.$("#priorityTwoEnabled").prop("checked"),keyPressSettings.priorityTwoProfile=e.top.$("#priorityTwoProfile").val(),keyPressSettings.priorityTwoButton=e.top.$("#priorityTwoButton").val(),keyPressSettings.priorityThreeEnabled=e.top.$("#priorityThreeEnabled").prop("checked"),keyPressSettings.priorityThreeProfile=e.top.$("#priorityThreeProfile").val(),keyPressSettings.priorityThreeButton=e.top.$("#priorityThreeButton").val(),keyPressSettings.defaultButton=e.top.$("#defaultButton").val(),e.top.$.jStorage.set("keyPressSettings",keyPressSettings)}function fillKeypressSettings(){null==e.top.$.jStorage.get("keyPressSettings")&&e.top.$.jStorage.set("keyPressSettings",keyPressSettings),keyPressSettings=e.top.$.jStorage.get("keyPressSettings"),keycodes.a=keyPressSettings.a_code,e.top.$("#hotkey_value_a").val(keyPressSettings.a_char),keycodes.b=keyPressSettings.b_code,e.top.$("#hotkey_value_b").val(keyPressSettings.b_char),keycodes.c=keyPressSettings.c_code,e.top.$("#hotkey_value_c").val(keyPressSettings.c_char),keycodes.master=keyPressSettings.master_code,e.top.$("#hotkey_value_master").val(keyPressSettings.master_char),keycodes.skip=keyPressSettings.skip_code,e.top.$("#hotkey_value_skip").val(keyPressSettings.skip_char),keycodes.left=keyPressSettings.left_code,e.top.$("#hotkey_value_left").val(keyPressSettings.left_char),keycodes.right=keyPressSettings.right_code,e.top.$("#hotkey_value_right").val(keyPressSettings.right_char),e.top.$("#priorityOneEnabled").prop("checked",keyPressSettings.priorityOneEnabled),e.top.$("#priorityOneProfile").val(keyPressSettings.priorityOneProfile),e.top.$("#priorityOneButton").val(keyPressSettings.priorityOneButton),e.top.$("#priorityTwoEnabled").prop("checked",keyPressSettings.priorityTwoEnabled),e.top.$("#priorityTwoProfile").val(keyPressSettings.priorityTwoProfile),e.top.$("#priorityTwoButton").val(keyPressSettings.priorityTwoButton),e.top.$("#priorityThreeEnabled").prop("checked",keyPressSettings.priorityThreeEnabled),e.top.$("#priorityThreeProfile").val(keyPressSettings.priorityThreeProfile),e.top.$("#priorityThreeButton").val(keyPressSettings.priorityThreeButton),e.top.$("#defaultButton").val(keyPressSettings.defaultButton)}function setKeyEditMode(t){return editingKey=!0,keyToEdit=t,e.top.UI.InfoMessage("Press any number, letter, or arrow key to set the hotkey for the <span style='font-weight:bold;'>"+t+"</span> button",1500),!1}function fillMasterSettings(){var t=e.top.$.jStorage.get("profileList");e.top.$.each(t,function(t,o){e.top.$("#priorityOneProfile").append("<option value='"+o+"'>"+o+"</option>"),e.top.$("#priorityTwoProfile").append("<option value='"+o+"'>"+o+"</option>"),e.top.$("#priorityThreeProfile").append("<option value='"+o+"'>"+o+"</option>")})}function selectMasterButton(t){var o,r=e.top.$.jStorage.get("profile:"+keyPressSettings.priorityOneProfile),i=e.top.$.jStorage.get("profile:"+keyPressSettings.priorityTwoProfile),a=e.top.$.jStorage.get("profile:"+keyPressSettings.priorityThreeProfile),l=t.children("td").eq(9).children("a"),n=t.children("td").eq(10).children("a"),s=t.children("td").eq(11).children("a");switch(o=keyPressSettings.defaultButton,keyPressSettings.priorityThreeEnabled&&!checkRowToHide(t,a)&&(o=keyPressSettings.priorityThreeButton),keyPressSettings.priorityTwoEnabled&&!checkRowToHide(t,i)&&(o=keyPressSettings.priorityTwoButton),keyPressSettings.priorityOneEnabled&&!checkRowToHide(t,r)&&(o=keyPressSettings.priorityOneButton),o){case"A":tryClick(l);break;case"B":tryClick(n);break;case"C":tryClick(s);break;default:t.hide()}}function setDefaultLanguage(){var t=getURL();switch(3==t.length&&t.shift(),t.join(".")){case"fyletikesmaxes.gr":e.top.$.jStorage.set("language","el");break;case"tribals.it":e.top.$.jStorage.set("language","it");break;case"guerrastribales.es":e.top.$.jStorage.set("language","es");break;case"tribalwars.ae":e.top.$.jStorage.set("language","ar");break;default:e.top.$.jStorage.set("language","en")}}function loadLanguage(t){e.top.$.jStorage.set("language",t);var o=e.top.$.jStorage.get("profileList"),r=e.top.$.jStorage.get("profile:"+profile_10);e.top.$.inArray(t,availableLangs)<0&&(t="en");var i=scriptURL+"lang/"+t+".js";e.top.$.getScript(i,function(){e.top.$("#settingsDiv").remove(),o[0]=profile_10,e.top.$.jStorage.set("profileList",o),e.top.$.jStorage.set("profile:"+profile_10,r),changeHeader(filter_40),showSettings()})}function addLanguages(){e.top.$("#language").append("<option value='en'>English</option>"),e.top.$("#language").append("<option value='el'>\xc3\u017d\xe2\u20ac\xa2\xc3\u017d\xc2\xbb\xc3\u017d\xc2\xbb\xc3\u017d\xc2\xb7\xc3\u017d\xc2\xbd\xc3\u017d\xc2\xb9\xc3\u017d\xc2\xba\xc3\u017d\xc2\xac</option>"),e.top.$("#language").append("<option value='it'>Italiano</option>"),e.top.$("#language").append("<option value='es'>Espa\xc3\u0192\xc2\xb1ol</option>"),e.top.$("#language").append("<option value='ar'>\xc3\u02dc\xc2\xa7\xc3\u2122\xe2\u20ac\u017e\xc3\u2122\xe2\u20ac\u017e\xc3\u02dc\xc2\xba\xc3\u02dc\xc2\xa9 \xc3\u02dc\xc2\xa7\xc3\u2122\xe2\u20ac\u017e\xc3\u02dc\xc2\xb9\xc3\u02dc\xc2\xb1\xc3\u02dc\xc2\xa8\xc3\u2122\xc5 \xc3\u02dc\xc2\xa9</option>")}function parseBool(e){return void 0!==e&&"true"===e.replace(/^\s+|\s+window.top.$/g,"").toLowerCase()}function getURL(){var t=e.location.hostname;return t=t.split(".")}function checkPage(){console.log("checkPage"),"am_farm"!==e.top.game_data.screen?getFA():run()}function getFA(){console.log("getFA"),fadeThanksToCheese(),openLoader();var t=link[0]+e.top.game_data.village.id+link[1];e.top.$.getScript("https://"+e.top.location.host+"/js/game/Accountmanager.js",function(){e.top.$.ajax({type:"GET",url:t,dataType:"html",error:function(t,o,r){alert("Get LA error: "+r),e.top.$("#fader").remove(),e.top.$("#loaders").remove()},success:function(t){var o=e.top.$(t),r=/<\s*title\s*>([^<]+)<\/title\s*>/g.exec(t)[1],i=e.top.$.parseJSON(t.split("TribalWars.updateGameData(")[1].split(");")[0]);e.top.game_data=i,"undefined"!=typeof history&&"function"==typeof history.pushState&&history.pushState({},e.top.game_data.village.name+" - Loot Assistant","https://"+e.top.location.host+game_data.link_base_pure+"am_farm"),e.top.$("#header_info").html(e.top.$("#header_info",o).html()),e.top.$("#topContainer").html(e.top.$("#topContainer",o).html()),e.top.$("#contentContainer").html(e.top.$("#contentContainer",o).html()),e.top.$("head").find("title").html(r),e.top.$("#fader").remove(),e.top.$("#loaders").remove(),console.log("getFA"),run()}})})}function fadeThanksToCheese(){var t=e.top.document.createElement("div");t.id="fader",t.style.position="fixed",t.style.height="100%",t.style.width="100%",t.style.backgroundColor="black",t.style.top="0px",t.style.left="0px",t.style.opacity="0.6",t.style.zIndex="12000",e.top.document.body.appendChild(t)}function openLoader(){var t=e.top.document.createElement("div");t.id="loaders",t.style.position="fixed",t.style.width="24px",t.style.height="24px",t.style.top="50%",t.style.left="50%",e.top.$(t).css("margin-left","-12px"),e.top.$(t).css("margin-top","-12px"),t.style.zIndex=13e3,e.top.$(t).append(e.top.$("<img src='graphic/throbber.gif' height='24' width='24'></img>")),e.top.$("#contentContainer").append(e.top.$(t))}function makeItPretty(){e.top.$(".row_a").css("background-color","rgb(216, 255, 216)"),e.top.$("#plunder_list tr").eq(0).remove(),e.top.$("#plunder_list").find("tr:gt(0)").each(function(t){e.top.$(this).removeClass("row_a"),e.top.$(this).removeClass("row_b"),t%2==0?e.top.$(this).addClass("row_a"):e.top.$(this).addClass("row_b")}),hideStuffs(),console.log("makeItPretty")}function hideStuffs(){e.top.$("#plunder_list").hide(),e.top.$("#plunder_list_nav").hide(),e.top.$("#contentContainer").find('div[class="vis"]').eq(0).children().eq(0).append(e.top.$("<div class='vis' style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#' num='0' onclick='uglyHider(window.top.$(this));return false;'>+</a></div>")),e.top.$("#contentContainer").find('div[class="vis"]').eq(0).children().eq(1).hide(),e.top.$("#am_widget_Farm").find("h4").eq(0).append(e.top.$("<div class='vis' style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#' num='1' onclick='uglyHider(window.top.$(this));return false;'>+</a></div>")),e.top.$("#plunder_list_filters").hide()}function uglyHider(t){var o;o=e.top.$("#settingsBody").length>0?2:1,"+"===e.top.$(t).text()?e.top.$(t).text("-"):e.top.$(t).text("+"),0==parseInt(e.top.$(t).attr("num"))?e.top.$("#contentContainer").find('div[class="vis"]').eq(o).children().eq(1).toggle():1==parseInt(e.top.$(t).attr("num"))?e.top.$("#plunder_list_filters").toggle():2==parseInt(e.top.$(t).attr("num"))&&e.top.$("#settingsBody").toggle()}function yaver_updateProfile_proxy(){try{var $=e.top.$||e.$;if(!$||!$.jStorage)return void console.log("[Yaver] jStorage not ready yet");var t=$("#settingsProfile").val();if(!t)return;var o=[];o.push($("#start_page").val()),o.push($("#end_page").val()),o.push($("#order_by").val()),o.push($("#direction").val()),o.push($("#all_none").prop("checked")),o.push($("#blue").prop("checked")),o.push($("#green").prop("checked")),o.push($("#yellow").prop("checked")),o.push($("#red_yellow").prop("checked")),o.push($("#red_blue").prop("checked")),o.push($("#red").prop("checked")),o.push($("#hide_recent_farms").prop("checked")),o.push($("#sent_time_filter").val()),o.push($("#hide_recent_time").val()),o.push($("#enable_hauls").prop("checked")),o.push($("#full").prop("checked")),o.push($("#partial").prop("checked")),o.push($("#enable_attacks").prop("checked")),o.push($("#attack_operator").val()),o.push($("#attack_value").val()),o.push($("#enable_walls").prop("checked")),o.push($("#wall_operator").val()),o.push($("#wall_value").val()),o.push($("#enable_distances").prop("checked")),o.push($("#distance_operator").val()),o.push($("#distance_value").val()),o.push($("#enable_scout").prop("checked")),o.push($("#scout_report_operator").val()),o.push($("#haul_value").val()),o.push($("#continent_display").val()),o.push($("#continents_list").val()),o.push($("#enable_time").prop("checked")),o.push($("#attack_time_filter").val()),o.push($("#time_value").val()),o.push($("#enable_auto_run").prop("checked")),o.push($("#next_village_no_farms").prop("checked")),o.push($("#next_village_scouts").prop("checked")),o.push($("#scouts_left").val()),o.push($("#next_village_farming_troops").prop("checked")),o.push($("#farming_troops_left").val()),o.push($("#next_village_units").prop("checked")),$.jStorage.set("profile:"+t,o),userset=o,e.top.UI&&e.top.UI.SuccessMessage&&e.top.UI.SuccessMessage("Saved \u2705",700)}catch(e){console.log("[Yaver] updateProfile proxy failed:",e)}}e.top.$.getScript(scriptURL+"lib/jstorage.js",function(){e.top.$.getScript(scriptURL+"resources.js",function(){null==e.top.$.jStorage.get("language")&&setDefaultLanguage(),e.top.$.getScript(scriptURL+"lang/"+e.top.$.jStorage.get("language")+".js",function(){console.log("init"),checkPage()})}),e.top.$.getScript(scriptURL+"notify.js")});try{e.updateProfile=yaver_updateProfile_proxy,e.top.updateProfile=yaver_updateProfile_proxy}catch(o){}try{e.applySettings=applySettings,e.top.applySettings=applySettings,e.resetTable=resetTable,e.top.resetTable=resetTable,e.changeProfile=changeProfile,e.top.changeProfile=changeProfile,e.loadLanguage=loadLanguage,e.top.loadLanguage=loadLanguage,e.uglyHider=uglyHider,e.top.uglyHider=uglyHider,e.setKeyEditMode=setKeyEditMode,e.top.setKeyEditMode=setKeyEditMode,e.createProfile=createProfile,e.top.createProfile=createProfile,e.setDefaultProfile=setDefaultProfile,e.top.setDefaultProfile=setDefaultProfile,e.deleteProfile=deleteProfile,e.top.deleteProfile=deleteProfile,e.exportProfile=exportProfile,e.top.exportProfile=exportProfile,e.importProfile=importProfile,e.top.importProfile=importProfile,e.__YAVER_EXPORT_OK__=!0}catch(r){console.log("[Yaver] export failed",r)}}window.__YAVER_UPROXY__="v2-uproxy-001",function(){window.updateProfile=function(){try{var $=function(){try{if(window.top&&window.top.jQuery)return window.top.jQuery;if(window.top&&window.top.$&&window.top.$.fn)return window.top.$}catch(e){}return window.jQuery?window.jQuery:window.$&&window.$.fn?window.$:null}();if(!$||!$.jStorage)return void console.log("[Yaver] jQuery/jStorage not ready yet");var e=$("#settingsProfile").val();if(!e)return;var t=[];t.push($("#start_page").val()),t.push($("#end_page").val()),t.push($("#order_by").val()),t.push($("#direction").val()),t.push($("#all_none").prop("checked")),t.push($("#blue").prop("checked")),t.push($("#green").prop("checked")),t.push($("#yellow").prop("checked")),t.push($("#red_yellow").prop("checked")),t.push($("#red_blue").prop("checked")),t.push($("#red").prop("checked")),t.push($("#hide_recent_farms").prop("checked")),t.push($("#sent_time_filter").val()),t.push($("#hide_recent_time").val()),t.push($("#enable_hauls").prop("checked")),t.push($("#full").prop("checked")),t.push($("#partial").prop("checked")),t.push($("#enable_attacks").prop("checked")),t.push($("#attack_operator").val()),t.push($("#attack_value").val()),t.push($("#enable_walls").prop("checked")),t.push($("#wall_operator").val()),t.push($("#wall_value").val()),t.push($("#enable_distances").prop("checked")),t.push($("#distance_operator").val()),t.push($("#distance_value").val()),t.push($("#enable_scout").prop("checked")),t.push($("#scout_report_operator").val()),t.push($("#haul_value").val()),t.push($("#continent_display").val()),t.push($("#continents_list").val()),t.push($("#enable_time").prop("checked")),t.push($("#attack_time_filter").val()),t.push($("#time_value").val()),t.push($("#enable_auto_run").prop("checked")),t.push($("#next_village_no_farms").prop("checked")),t.push($("#next_village_scouts").prop("checked")),t.push($("#scouts_left").val()),t.push($("#next_village_farming_troops").prop("checked")),t.push($("#farming_troops_left").val()),t.push($("#next_village_units").prop("checked")),$.jStorage.set("profile:"+e,t);try{window.userset=t}catch(e){}try{userset=t}catch(e){}window.top&&window.top.UI&&window.top.UI.SuccessMessage&&window.top.UI.SuccessMessage("Saved \u2705",700)}catch(e){console.log("[Yaver] updateProfile proxy failed:",e)}};try{window.top.updateProfile=window.updateProfile}catch(e){}window.__YAVER_EXPORT_OK__=!0}();